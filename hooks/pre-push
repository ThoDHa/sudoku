#!/bin/bash
set -e

# Get the repository root directory
REPO_ROOT="$(git rev-parse --show-toplevel)"

echo "========================================"
echo "  Pre-Push Checks"
echo "========================================"
echo ""

# Go checks
echo "[1/2] Running Go checks..."
echo "  - go vet"
echo "  - go test -short"
echo ""

cd "$REPO_ROOT/api"
go vet ./...
go test -short -v -timeout=5m ./...

echo ""
echo "[1/2] Go checks passed!"
echo ""

# Frontend checks
echo "[2/2] Running Frontend checks..."
echo "  - tsc --noEmit"
echo "  - npm run test:unit"
echo "  - npm run build"
echo ""

cd "$REPO_ROOT/frontend"
npx tsc --noEmit
npm run test:unit
npm run build

echo ""
echo "[2/2] Frontend checks passed!"
echo ""
echo "========================================"
echo "  All checks passed! Pushing..."
echo "========================================"
