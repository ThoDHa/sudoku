@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  /* Default theme (blue light) - will be overridden by ThemeContext */
  --bg: #f8fafc;
  --bg-secondary: #f1f5f9;
  --text: #1e293b;
  --text-muted: #64748b;
  --board-bg: #ffffff;
  --cell-bg: #ffffff;
  --cell-hover: #f1f5f9;
  --cell-selected: #bfdbfe;
  --cell-peer: #e0e7ff;
  --cell-primary: #93c5fd;
  --cell-secondary: #bfdbfe;
  --border-strong: #1e293b;
  --border-light: #cbd5e1;
  --text-given: #1e293b;
  --text-entered: #2563eb;
  --text-candidate: #94a3b8;
  --btn-bg: #f1f5f9;
  --btn-hover: #e2e8f0;
  --btn-active: #2563eb;
  --btn-active-text: #ffffff;
  --accent: #2563eb;
  --accent-light: #dbeafe;

  /* ============================================================
     FLUID SPACING SCALE
     Uses dvmin (smaller of vw/vh) for aspect-ratio-aware scaling
     ============================================================ */
  --space-xs: clamp(0.125rem, 0.5dvmin, 0.25rem);
  --space-sm: clamp(0.25rem, 1dvmin, 0.5rem);
  --space-md: clamp(0.5rem, 1.5dvmin, 0.75rem);
  --space-lg: clamp(0.75rem, 2dvmin, 1rem);
  --space-xl: clamp(1rem, 3dvmin, 1.5rem);
  --space-2xl: clamp(1.5rem, 4dvmin, 2rem);

  /* ============================================================
     FLUID TYPOGRAPHY SCALE
     Scales with viewport while respecting min/max readability
     ============================================================ */
  --text-xs: clamp(0.625rem, 1.5dvmin, 0.75rem);
  --text-sm: clamp(0.75rem, 2dvmin, 0.875rem);
  --text-base: clamp(0.875rem, 2.5dvmin, 1rem);
  --text-lg: clamp(1rem, 3dvmin, 1.125rem);
  --text-xl: clamp(1.125rem, 3.5dvmin, 1.25rem);
  --text-2xl: clamp(1.25rem, 4dvmin, 1.5rem);
  --text-3xl: clamp(1.5rem, 5dvmin, 2rem);

  /* ============================================================
     LAYOUT CONSTANTS
     Fixed values for structural elements
     ============================================================ */
  --header-height: 3rem;
  --game-header-height: 3rem;
  --page-padding: clamp(0.5rem, 2dvw, 1.5rem);
  
  /* ============================================================
     GAME-SPECIFIC VARIABLES
     Height-aware sizing for board + controls
     ============================================================ */

  /* Legacy spacing (kept for backwards compatibility) */
  --spacing-xs: 0.25rem;
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;

  /* Border radius */
  --radius-sm: 0.375rem;
  --radius-md: 0.5rem;
  --radius-lg: 0.75rem;
  --radius-xl: 1rem;
  --radius-2xl: 1.5rem;
  --radius-full: 9999px;

  /* Board specific */
  --board-radius: 0.75rem;

  /* Font sizes - defaults, overridden by ThemeContext based on fontSize setting */
  --cell-font-size: 1.125rem;
  --cell-font-size-sm: 1.375rem;
  --cell-font-size-md: 1.625rem;
  --cell-font-size-lg: 1.875rem;
  --cell-font-size-xl: 2.125rem;
  --candidate-font-size: 8px;
  --candidate-font-size-sm: 9px;
  --candidate-font-size-md: 11px;
  --candidate-font-size-lg: 12px;
  --candidate-font-size-xl: 14px;
  --control-btn-size: 3rem;
  --control-font-size: 1.125rem;

  /* Legacy font sizes (for non-board elements) */
  --font-xs: 0.75rem;
  --font-sm: 0.875rem;
  --font-base: 1rem;
  --font-lg: 1.125rem;
  --font-xl: 1.25rem;
  --font-2xl: 1.5rem;

  /* Shadows */
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);

  /* Error colors - now set by ThemeContext, these are fallbacks */
  --error-bg: #fecaca;
  --error-text: #dc2626;
  
  /* Hint colors - now set by ThemeContext, these are fallbacks */
  --hint-text: #22c55e;
}

html, body {
  @apply bg-background text-foreground antialiased;
  /* Prevent scroll and fix mobile viewport issues */
  overflow: hidden;
  height: 100vh;
  height: 100dvh; /* Dynamic viewport height for mobile */
  margin: 0;
  padding: 0;
}

/* Hide scrollbar but allow scrolling */
.scrollbar-hide {
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none;  /* Firefox */
}

.scrollbar-hide::-webkit-scrollbar {
  display: none;  /* Chrome, Safari and Opera */
}

/* Transitions moved to end of file with prefers-reduced-motion support */

/* ============================================================
   GAME CONTAINER - Master layout for board + controls
   ============================================================ */

/* Game area wrapper - establishes height constraints for game pages */
/* Calculates available space after header for board + controls */
/* Controls are 4 board cells wide, with 3x3 digit grid + action row */
/* Controls height ≈ 58% of board width (44.44 + 10.36 + gaps) */
/* So total = board + 0.58*board = 1.58*board, meaning board = available / 1.58 ≈ 63% */
.game-area {
  --available-height: calc(100dvh - var(--game-header-height) - var(--page-padding) * 2);
  /* Board can be at most 63% of available height (controls take remaining 37%) */
  --board-max-by-height: calc(var(--available-height) * 0.63);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: calc(100dvh - var(--game-header-height));
  /* Equal padding above board and below controls */
  padding: var(--page-padding);
}

/* Game container - establishes container query context for all game elements */
/* Used by Game.tsx, Custom.tsx, Homepage.tsx for consistent sizing */
/* Respects available height constraint for proper scaling */
/* Also has absolute max-width to prevent excessive stretching on ultrawides */
.game-container {
  container-type: inline-size;
  container-name: game;
  width: 100%;
  /* Gap between board and controls - matches page-padding for visual consistency */
  gap: var(--page-padding);
  /* Constrain by available height to prevent overflow */
  /* Also cap at 40rem (640px) to prevent ultrawide sprawl */
  max-width: min(var(--board-max-by-height, 100%), 40rem);
}

/* Page container - for content pages that need max-width and padding */
/* Uses fluid spacing for consistent scaling */
.page-container {
  @apply mx-auto max-w-4xl bg-background min-h-full;
  padding: var(--page-padding);
}

/* Page title - fluid scaling for content page headers */
.page-title {
  font-size: var(--text-3xl);
  font-weight: 700;
  margin-bottom: var(--space-md);
}

/* Section title - fluid scaling for section headers */
.section-title {
  font-size: var(--text-xl);
  font-weight: 600;
  margin-bottom: var(--space-md);
}

/* Back link - consistent styling for navigation */
.back-link {
  display: inline-block;
  font-size: var(--text-sm);
  margin-bottom: var(--space-xl);
}

/* Content card - fluid padding for cards in content pages */
.content-card {
  padding: var(--space-lg);
  border-radius: var(--radius-lg);
}

/* Content grid - fluid gaps for card grids */
.content-grid {
  display: grid;
  gap: var(--space-lg);
}

/* ============================================================
   HOMEPAGE / DIFFICULTY GRID SCALING
   ============================================================ */

/* Difficulty grid - fluid gaps */
.difficulty-grid {
  gap: 3dvmin;
}

/* Daily card - fluid padding and sizing, wider than tall */
.daily-card {
  padding: 1dvmin 3dvmin;
  gap: 0.25dvmin;
  aspect-ratio: 10 / 2;
}

/* Enso logo - scales with viewport */
.enso-logo {
  width: 12dvmin;
  height: auto;
  margin-bottom: var(--space-md);
}

/* Homepage heading - fluid typography */
.homepage-title {
  font-size: var(--text-2xl);
  font-weight: 700;
  margin-bottom: var(--space-xs);
}

.homepage-subtitle {
  font-size: var(--text-sm);
  margin-bottom: var(--space-md);
}

/* Sudoku board styling - grid and visual appearance only */
/* Container query context for font scaling */
.sudoku-board {
  @apply grid grid-cols-9 border-2 border-board-border bg-board-bg rounded-board overflow-hidden;
  container-type: inline-size;
  container-name: sudoku-board;
}

/* Cell styling - fonts scale with container width using cqi units */
.sudoku-cell {
  display: flex;
  align-items: center;
  justify-content: center;
  aspect-ratio: 1;
  cursor: pointer;
  box-sizing: border-box;
  font-weight: 600;
  /* Font size scales purely with container - no min/max constraints */
  font-size: 5cqi;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  /* No min-width/min-height - let the grid control sizing */
}

/* Candidate grid */
.candidate-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  width: 100%;
  height: 100%;
  padding: 0.5cqi;
}

/* Candidate digits - scale with container */
.candidate-digit {
  display: flex;
  align-items: center;
  justify-content: center;
  /* Candidate font scales purely with container */
  font-size: 2.2cqi;
  font-weight: 500;
  line-height: 1;
}

/* ============================================================
   MOBILE TOUCH-FRIENDLY NUMBER PAD
   ============================================================ */

/* Controls scale based on the parent .game-container's width */
/* No separate container needed - inherits from game container */

/* Controls grid layout - gaps scale with container */
.controls-grid {
  /* Gap between digit grid and action row */
  gap: 1.5cqi;
  /* No top margin - spacing handled by parent .game-container gap */
}

.digit-grid {
  /* 3x3 grid layout */
  display: grid;
  grid-template-columns: repeat(3, auto);
  gap: 1cqi;
  justify-content: center;
}

.digit-row {
  /* Gap between digit buttons in a row */
  gap: 1cqi;
}

.action-row {
  /* Gap between action buttons */
  gap: 1cqi;
}

/* Control digit buttons - scale with container width */
/* Controls total width = 4 board cells = 4 × (100/9)cqi ≈ 44.44cqi */
/* Digit grid: 3 buttons + 2 gaps (1cqi each) = 44.44cqi */
/* So 3 buttons = 44.44 - 2 = 42.44cqi, each button ≈ 14.15cqi */
.control-digit-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  aspect-ratio: 1;
  /* Width: (44.44 - 2) / 3 ≈ 14.15cqi */
  width: 14.15cqi;
  border-radius: 0.375rem;
  /* Subtle border for contrast against background */
  border: 1px solid var(--border-light);
  /* Font scales with button size */
  font-size: 6cqi;
  font-weight: 600;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  user-select: none;
}

/* Font size scales with button for large font preference */
@container game (min-width: 1px) {
  :root.font-large .control-digit-btn {
    font-size: 7cqi;
  }
}

/* Action buttons (notes, erase, undo, redo) */
.control-action-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.75rem;
  border-radius: 0.5rem;
  /* Subtle border for contrast against background */
  border: 1px solid var(--border-light);
  font-size: 1.25rem;
  min-width: 44px;
  min-height: 44px;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  user-select: none;
}

@media (max-width: 639px) {
  .control-action-btn {
    min-width: 48px;
    min-height: 48px;
    font-size: 1.375rem;
  }

  :root.font-large .control-action-btn {
    min-width: 56px;
    min-height: 56px;
    font-size: 1.5rem;
  }
}

/* Compact action buttons for single row layout (Notes, Delete, Undo, Redo) */
/* Controls total width = 4 board cells ≈ 44.44cqi */
/* Action row: 4 buttons + 3 gaps (1cqi each) = 44.44cqi */
/* So 4 buttons = 44.44 - 3 = 41.44cqi, each button ≈ 10.36cqi */
.control-action-btn-compact {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.375rem;
  border-radius: 0.375rem;
  /* Subtle border for contrast against background */
  border: 1px solid var(--border-light);
  /* Width: (44.44 - 3) / 4 ≈ 10.36cqi */
  width: 10.36cqi;
  aspect-ratio: 1;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  user-select: none;
}

/* Icon sizing within action buttons - scales with container */
/* Icons scale proportionally with button size (roughly 50% of button width) */
.control-action-btn-compact svg {
  width: 5.5cqi;
  height: 5.5cqi;
}

.control-action-btn-compact .text-base {
  font-size: 5cqi;
}

/* Action buttons with text labels (shown on larger screens) */
.control-action-btn-labeled {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.125rem;
  padding: 0.5rem 0.75rem;
  border-radius: 0.5rem;
  /* Subtle border for contrast against background */
  border: 1px solid var(--border-light);
  min-width: 44px;
  min-height: 44px;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  user-select: none;
}

@media (max-width: 639px) {
  .control-action-btn-labeled {
    min-width: 48px;
    min-height: 48px;
    padding: 0.625rem;
  }

  :root.font-large .control-action-btn-labeled {
    min-width: 56px;
    min-height: 56px;
  }
}

@media (min-width: 640px) {
  .control-action-btn-labeled {
    min-width: 56px;
    min-height: 52px;
    padding: 0.375rem 0.75rem;
    gap: 0.125rem;
  }
}

/* Remaining count badge on digit buttons */
.digit-remaining-badge {
  position: absolute;
  bottom: -0.5cqi;
  right: -0.5cqi;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 3cqi;
  height: 3cqi;
  border-radius: 9999px;
  font-size: 1.5cqi;
  font-weight: 600;
}

/* Font size selector buttons */
.font-size-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.25rem 0.5rem;
  border-radius: 0.375rem;
  /* Subtle border for contrast against background */
  border: 1px solid var(--border-light);
  font-weight: 500;
  min-height: 32px;
}

.font-size-btn-xs {
  font-size: 0.625rem;
}

.font-size-btn-small {
  font-size: 0.75rem;
}

.font-size-btn-medium {
  font-size: 0.875rem;
}

.font-size-btn-large {
  font-size: 1rem;
}

.font-size-btn-xl {
  font-size: 1.125rem;
}

/* ============================================================
   TRANSITIONS - Consolidated with accessibility support
   ============================================================
   All transitions are disabled when user prefers reduced motion.
   This improves battery life and respects accessibility preferences.
   ============================================================ */

@media (prefers-reduced-motion: no-preference) {
  /* Theme-aware containers - smooth color transitions during theme changes */
  body,
  .sudoku-board,
  .game-container,
  header,
  main {
    transition: background-color 150ms ease-in-out,
                border-color 150ms ease-in-out,
                color 150ms ease-in-out;
  }

  /* Sudoku cells - NO background transition to prevent visual "layering" 
     effect when highlight state changes rapidly on mobile.
     Previous 150ms transition caused old highlights to appear to persist
     briefly when toggling candidates in multi-fill mode. */
  .sudoku-cell {
    /* transition: background-color 150ms ease-in-out; */
  }

  /* Hover effects only on devices with true pointer hover capability (not touch).
     On mobile/touch devices, :hover states can become "sticky" after tapping,
     causing a persistent highlight that looks like a second layer. */
  @media (hover: hover) and (pointer: fine) {
    .sudoku-cell:hover {
      background-color: var(--cell-hover);
    }

    /* Control button hover states - only for mouse/trackpad users */
    .control-digit-btn:not(:disabled):hover,
    .control-action-btn:not(:disabled):hover,
    .control-action-btn-compact:not(:disabled):hover,
    .control-action-btn-labeled:not(:disabled):hover {
      background-color: var(--btn-hover);
    }
  }

  /* Control buttons - interactive feedback */
  .control-digit-btn,
  .control-action-btn,
  .control-action-btn-compact,
  .control-action-btn-labeled,
  .font-size-btn {
    transition: background-color 150ms ease-in-out,
                border-color 150ms ease-in-out,
                color 150ms ease-in-out,
                transform 150ms ease-in-out;
  }
}
